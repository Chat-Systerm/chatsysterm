
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>base 64</title>
<style>
</style>
<script>
    window.onload = function () {
        var input = document.getElementById("fielinput");
        var txshow = document.getElementById("txshow");
        if (typeof (FileReader) === 'undefined') {
            result.innerHTML = "抱歉，你的浏览器不支持 FileReader，请使用现代浏览器操作！";
            input.setAttribute('disabled', 'disabled');
        } else {
            input.addEventListener('change', readFile, false);
        }
    }
    function readFile() {
        var file = this.files[0];
        //readAsDataURL方法会读取指定的 Blob 或 File 对象。
        //读取操作完成的时候,result 属性将包含一个data:URL格式的字符串（base64编码）以表示所读取文件的内容
        var reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = function (e) { 
            //img的src属性或background的url属性，可以通过被赋值为图片网络地址或base64的方式显示图片

            var typee = this.result.substring(this.result.indexOf('/')+1,this.result.indexOf(';'));
            console.log(typee);
            if((typee =="png")||(typee == "img")){
                imgshow.src = this.result;
                document.getElementById("imgshow").style.display='block';
            }
            else if(typee == "mp4"){
                vidshow.src = this.result;
                document.getElementById("vidshow").style.display='block';
            }
            else if(typee == "mp3"){
                audshow.src = this.result; 
                document.getElementById("audshow").style.display='block';
                //TODO:在用户成功发送后清空对应src和display
            }
            //document.getElementById("data").innerText=this.result.substring(this.result.indexOf(',')+1); 
		}
    }
 
</script>
</head>
<body>
<input type="file" id="fielinput" />
<br/>解析之后的base64数据：<br/>
<p id="data"></p>
<ul>
    <li>
        <img id="imgshow" style="width:100px;height:100px;display:none;"/>
        <audio id="audshow" controls="controls" style="display: none;"></audio>
        <video id ="vidshow" controls="controls" style="display:none;"></video>
    </li>
</ul>
</body>
</html>